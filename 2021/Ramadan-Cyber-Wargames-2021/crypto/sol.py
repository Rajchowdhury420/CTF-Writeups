from mt19937predictor import MT19937Predictor
from sympy.ntheory.modular import crt
from Crypto.Util.number import *
import gmpy2


def encrypt(m,par1,par2,l):
	c = []
	for i in range(0,l):
		c.append((ord(m[i])^(par1[i]^par2[i])))
	return c


leaked= [2889287952, 977971868, 3748397061, 1984047696, 3980152658, 3137178565, 3918643953, 4026151984, 3474075761, 2678463606, 175727269, 3743592558, 3732916576, 2040778809, 158184029, 37289202, 1826972485, 1288771332, 3509636801, 2994951290, 2883443077, 385192167, 3349576678, 1707336780, 857244028, 1266902046, 665271126, 2139954313, 2711439795, 4208050664, 1410222379, 4206106034, 2518717723, 2447210233, 3723376050, 3905580846, 1995791671, 1554104436, 1337465831, 3676608444, 3480761373, 1652305041, 3817087283, 2067534459, 3194571931, 2493873628, 2022661181, 3985098419, 3324907008, 1980565900, 319594810, 2854374969, 1949651393, 1276852958, 107246511, 3648122589, 779115834, 814075571, 532621423, 2695380533, 1384856612, 2517826590, 1567351580, 1554089988, 1582849289, 744499001, 1407328030, 2401861851, 988244951, 3205045049, 1861634068, 491362114, 1152119466, 2919131453, 1542418132, 3290538805, 969184957, 780556224, 2943460692, 3554565932, 1469006401, 1564824508, 250820678, 1067267832, 3623890622, 2272169271, 4287873503, 1389386459, 1278478704, 2213938517, 1522855235, 3376680864, 2581292823, 1003249398, 2555547721, 1935040139, 1471754180, 1706690504, 3616761607, 983456579, 1277966329, 983089196, 733749446, 14404696, 2297227698, 3198164246, 27873133, 4274378133, 1836811888, 2703027896, 3425171396, 105544171, 3820134758, 830974145, 1374183442, 3525004644, 3303731658, 3578604976, 3535768346, 151849275, 1228500677, 4013124762, 3825518376, 3099995085, 3071013935, 36466248, 1784876960, 3423243947, 1984136020, 2742889743, 3474184013, 733604452, 3972552044, 343311947, 413639554, 1427997424, 4029664868, 3123449696, 2515321636, 433027457, 3719272730, 4249819897, 4122962288, 4020859603, 1158256864, 254440408, 373203955, 4279778921, 2750547373, 692334949, 1400738463, 228365833, 2372112021, 2671753333, 1622424529, 3008947648, 3571369716, 2834087854, 2120484576, 305253240, 1126730988, 857405353, 1419074645, 1253689438, 3498796700, 470881973, 3273117089, 3834059835, 3185760070, 1264354391, 303057529, 2693344249, 1627609651, 1574872694, 2065275354, 2919510827, 1729435333, 3716813970, 1530307558, 1421228478, 1944237497, 1211317500, 1544787634, 1733793458, 2626192795, 3244279102, 2374043744, 2398184753, 1973021145, 2740793825, 4218145125, 174156833, 3938093210, 1053644384, 1649009538, 2523780162, 4248056913, 2770690614, 3125841398, 901600980, 2074990699, 2862876537, 1837259040, 540750159, 2827112850, 1665902953, 1338982305, 3149173596, 3771945543, 501892416, 3085119481, 3335580378, 2491503382, 2012136526, 2251868850, 3953758872, 3871337865, 3539794484, 1380146109, 3389289625, 2611377650, 1878661742, 3479920138, 3161509455, 2978328876, 1612584779, 2565725270, 4025788558, 2675037725, 2644888247, 3097944317, 2248645085, 203026327, 1149324462, 2985121310, 1191143598, 1686402713, 1802418387, 3147134176, 2858163957, 1333188466, 3511719474, 3489664432, 2616708482, 1181733116, 2487549449, 326020749, 2957787791, 3161383034, 162786772, 2003586312, 3866678377, 3819703770, 1764434831, 2476924618, 1542624953, 3432276221, 3993221288, 2163138047, 1840357336, 2869880388, 1160873245, 2085790606, 1171362258, 3458764944, 3043293480, 596001056, 1329386089, 3618135463, 1285243581, 2480853139, 1488989366, 2578704010, 1260450565, 220471289, 1119523207, 1753114685, 2230185415, 2692664539, 3013798396, 4003235136, 2512847050, 521317480, 781414822, 3739288119, 3734293482, 4095117735, 1462255980, 4011737161, 3999389731, 2702241950, 2304168042, 1973969188, 4161095931, 3839056738, 2423787594, 1027060717, 369070402, 262804232, 3024409631, 3811685528, 3654665075, 4116247947, 2767385398, 3380604832, 2730169820, 1546451370, 1674045464, 1668429291, 3647652079, 1733758813, 234952149, 2255648295, 3880562201, 2021969014, 3135198977, 3520908192, 2168859696, 4059536207, 66882020, 2457627092, 457035598, 1159348351, 3157534409, 657446682, 880606655, 108728451, 1750904502, 1278161966, 605638606, 2793734768, 2365592819, 692779506, 3873388655, 1047603068, 1996998534, 2917263192, 4112452919, 1383685287, 2170656179, 319517051, 3413585505, 2141484024, 2109557612, 2663553018, 867701583, 3273418413, 262643898, 2160164517, 1162551502, 2031127162, 788098891, 1490430317, 1477387959, 2561365320, 1002446953, 2507475833, 2258289231, 1534067493, 1715256474, 1452636733, 2465642217, 2010381970, 2485700010, 3855465592, 40083530, 3277519317, 3615454426, 2505820523, 461666600, 1635387261, 2467484833, 2149022424, 159903903, 3338043532, 3061309627, 4077085804, 1914771621, 4218758236, 4257379405, 360978482, 3084296649, 1632096117, 2044012532, 1913353335, 3049152961, 237492467, 2779253759, 649743714, 1059614821, 1199589829, 2181639776, 1888243118, 1660424226, 2576315333, 2062704435, 1726912467, 1009369749, 1902625908, 112712322, 1029708194, 4003863516, 2894548041, 1854916350, 1094804587, 488013987, 3941324332, 3943190271, 18643731, 3104631046, 1234633839, 542962349, 3547489188, 1310074667, 1028189433, 3441019802, 1895344607, 910280652, 702089903, 4127947799, 3236449235, 1596700850, 2882963579, 2324857553, 2581487721, 914410526, 576157963, 3861925970, 2823866778, 1736041766, 3619797220, 2136841962, 4054341173, 1610896049, 1794785247, 2486603972, 2829484656, 1809458615, 1187530995, 789394974, 1793329127, 945493149, 369520298, 1028894164, 3499324203, 4230090069, 2290350971, 3927507194, 18914063, 3117576652, 1626254419, 2564895676, 2646731222, 141512198, 1842660852, 2022400330, 350653534, 1554554619, 859391393, 2649752230, 335190069, 1474204415, 620741232, 3554411904, 2743889622, 2213157922, 987171867, 289623296, 334004464, 218726724, 2047207354, 3711492734, 1690592733, 2255096223, 2741553173, 3578911980, 1407909582, 3563974254, 1912722868, 1792285916, 3406415314, 1674817095, 2832645258, 3542975659, 3036532323, 2183067140, 1108380631, 2339437998, 270512440, 3375964135, 125936011, 2133057932, 807206186, 75726895, 1433162331, 3183311989, 1527500958, 875114713, 175084045, 3887870307, 1706390494, 2130183928, 678931841, 472104318, 2366071264, 3544950952, 1388183036, 922096788, 124555983, 1765011377, 3839238526, 1248886449, 3957912622, 1113475350, 2397554565, 1035999748, 3951394191, 3827502825, 3532434787, 3267497202, 4248516077, 2215476422, 385783356, 188093750, 2746858672, 1622876149, 3757603493, 3802535925, 3028104226, 3679248698, 800028488, 3420734224, 3832862537, 2611636233, 3348530067, 3931347174, 1997266542, 1356096587, 2540256468, 2719362945, 4014763660, 3779447438, 3779335997, 2800786223, 742428004, 3474924509, 595291982, 3239574230, 3581797822, 2161335392, 2967409299, 655490453, 2263050971, 3932834403, 4276590962, 1461762510, 3398891260, 1650328940, 660638945, 3177378036, 2612545780, 2704110316, 31113785, 1827429983, 736699500, 3859244684, 462294153, 807817645, 399359260, 1954077599, 308316152, 755734304, 3486979761, 1060078358, 3920590773, 628641883, 580661685, 615883, 1139533210, 2090335196, 1745980708, 1999883567, 4223834725, 3866709643, 2833442557, 2762460365, 1409060079, 1617020688, 393517100, 2168735649, 2950314063, 4052260747, 2806401867, 4292531811, 1299496777, 1244148444, 916786125, 544580043, 1526751958, 3626441032, 3266189043, 4078025273, 1958176795, 787511644, 1990314943, 2690017501, 1379204089, 2732025727, 4126012975, 1149875103, 1951408647, 24841245, 1263141618, 3911494570, 2752414591, 1680604844, 3747247183, 69516049, 2845497408, 3705255728, 1827770690, 14648296, 161380761, 2231357008]
cipher= [552823633076106, 131578975084215, 327316417511866, 167119179318720, 552915537395590, 151469526528583, 30035787291740, 183585635965921, 87082244555796, 467085342568139, 543689752419448, 457942707033352, 284531797745303, 99642341847408, 309428391934037, 320188588781011, 351263546566677, 177673485109589, 538471826786123, 478240535772334, 77597644665434, 133752918767901, 221462600740227, 242973697539537, 302227910125634, 488395671137082, 559392529638040, 407948520828944, 382671870134497, 78804597800527, 398826516098977, 129511741506365, 456144696921422, 473050319863105, 103187149076601, 506348175015949, 420147571302041, 146737435467812, 156693964493475, 11626635257398, 222039439433566, 369463250484623, 94167543879574, 274404644197862, 207439409135129, 78581531347982, 350072592407652]

predictor = MT19937Predictor()

for i in range(624):
	predictor.setrandbits(leaked[i], 32)

# assert predictor.getrandbits(32) == part1[624]

npart1 = leaked + [predictor.getrandbits(32) for _ in range(975-624)]

# assert npart1 == part1

npart1 = npart1[::-1]
known = 'CTFAE{'
npart2 = encrypt(known,npart1,cipher,len(known))
print(npart2)

"""
LCG(lehmar) Cracker implementation here

c0 = x**25 % p
c1 = x**26 % p = c0*x % p
c2 = x**27 % p = c1*x % p
"""
p = 584086853872567
x = 220

# assert [pow(x,i,p) for i in range(25,25+6)] == npart2

par2 = []

for i in range(25,1000):
   par2.append(pow(x,i,p))

flag = [a^b^c for a,b,c in zip(cipher,npart1,par2)]
flag = ''.join([chr(i) for i in flag])
print(flag)

# CTFAE{9ae1c1434b676e5ddbc3874a9e6e46ff05e39eff}
