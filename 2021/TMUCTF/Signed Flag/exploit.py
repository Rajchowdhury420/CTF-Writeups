#!/usr/bin/env python3
from Crypto.Util.number import *
from hashlib import sha1
from pwn import *

# p = process('python3 chall.py'.split())
p = remote('185.235.41.166', 5000)

while True:
    try:
        p.recvuntil(b'q =')
        q = int(p.recvline())

        print(f'{q = }')
        data = p.recvuntil('\n\n').split()
        m1 = data[0][6:-2]
        s1 = int(data[-1])

        data = p.recvuntil('\n\n').split()
        m2 = data[0][6:-2]
        s2 = int(data[-1])

        # print(data)
        # print(m1, s1)
        # print(m2, s2)

        data = p.recvuntil('\n\n').split()
        s3 = int(data[2])
        r3= int(data[3])

        # print(data)
        # print(s3,r3)

        h1 = int(sha1(m1).hexdigest(), 16)
        h2 = int(sha1(m2).hexdigest(), 16)
        k = (h2-h1) * inverse(s2-s1, q) % q
        d = (s1*k - h1) * inverse(r3,q) % q
        h3 = (s3*k - d*r3) % q

        print(f"{k = }")
        print(f"{d = }")
        print(f"{h3 = }")

        p.sendlineafter('SHA1(secret) : ', str(h3))
        res = p.recvuntil('\n\n')
        print(res)
    except:
        p.interactive()
        exit()
